<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WearCast</title>
  <link rel="manifest" href="manifest.webmanifest?v=3" />
  <meta name="theme-color" content="#0b1220" />
  <link rel="icon" href="icon.svg?v=3" type="image/svg+xml" />
  <link rel="stylesheet" href="styles.css?v=3" />
</head>
<body>
  <header>
    <div class="brand">
      <img class="logo" src="icon.svg" alt="WearCast logo" />
      <div class="title">
        <h1>WearCast</h1>
        <p class="subtitle">What to wear, based on your local conditions.</p>
      </div>
    </div>
    <div class="header-actions">
      <button id="refreshBtn" class="btn">Refresh</button>
    </div>
  </header>

  <main>
    <section class="card" aria-label="Location">
      <div class="row" style="gap:12px; align-items: end;">
        <div class="grow">
          <label for="placeInput">Location</label>
          <input id="placeInput" type="text" placeholder="e.g., Berlin" autocomplete="off" />
          <div class="hint">Search a city (e.g., “Berlin”) or use your device location.</div>
        </div>
        <button id="geoBtn" class="btn secondary">Use my location</button>
        <button id="searchBtn" class="btn">Search</button>
      </div>
      <div id="placeStatus" class="status" role="status"></div>
    </section>

    <section class="grid">
      <section class="card" aria-label="Recommendation">
        <div class="card-title">
          <h2>Recommendation</h2>
          <span id="recBadge" class="badge">—</span>
        </div>

        <div id="severity" class="alert" role="status">
          <div class="alert-top">
            <span id="severityTitle" class="alert-title">—</span>
            <span id="severityMeta" class="alert-meta">—</span>
          </div>
          <div id="severityDetail" class="alert-detail">—</div>
        </div>

        <div id="recommendation" class="recommendation">Enter a location to get a suggestion.</div>
        <div class="divider"></div>
        <div class="row" style="gap:10px; flex-wrap: wrap;">
          <label class="chip"><input type="checkbox" id="prefCold" /> I run cold</label>
          <label class="chip"><input type="checkbox" id="prefHot" /> I run hot</label>
          <label class="chip"><input type="checkbox" id="prefFormal" /> Prefer formal-ish</label>
          <label class="chip"><input type="checkbox" id="prefBike" /> I’ll bike/walk</label>
        </div>
        <div class="hint" style="margin-top:10px;">Preferences adjust how recommendations are generated.</div>
      </section>

      <section class="card" aria-label="Conditions">
        <div class="card-title">
          <h2>Conditions now</h2>
          <span id="updatedAt" class="muted">—</span>
        </div>
        <div class="kv">
          <div><span class="k">Temp</span><span id="temp">—</span></div>
          <div><span class="k">Feels like</span><span id="apparent">—</span></div>
          <div><span class="k">Wind</span><span id="wind">—</span></div>
          <div><span class="k">Humidity</span><span id="humidity">—</span></div>
          <div><span class="k">Cloud cover</span><span id="cloud">—</span></div>
          <div><span class="k">Precip (1h)</span><span id="precip">—</span></div>
          <div><span class="k">Precip chance</span><span id="precipProb">—</span></div>
        </div>
        <div class="divider"></div>
        <details>
          <summary>Show more</summary>
          <div class="kv" style="margin-top:12px;">
            <div><span class="k">Effective temp</span><span id="effTemp">—</span></div>
            <div><span class="k">Dew point</span><span id="dewPoint">—</span></div>
            <div><span class="k">UV index</span><span id="uv">—</span></div>
            <div><span class="k">Visibility</span><span id="vis">—</span></div>
            <div><span class="k">Is day</span><span id="isDay">—</span></div>
            <div><span class="k">Weather</span><span id="wcode">—</span></div>
          </div>
        </details>
      </section>
    </section>

    <section class="card" aria-label="What changed">
      <div class="card-title">
        <h2>Why this recommendation?</h2>
        <span class="muted">transparent rules</span>
      </div>
      <ul id="reasons" class="reasons"></ul>
    </section>

    <section class="card" aria-label="About">
      <details>
        <summary>About & Privacy</summary>
        <div class="prose">
          <p><strong>WearCast</strong> suggests clothing based on weather conditions (temperature, wind, humidity, rain risk, UV).</p>
          <p><strong>Data sources:</strong> Weather via <a href="https://open-meteo.com/" target="_blank" rel="noreferrer">Open‑Meteo</a>. Place search / reverse geocoding via <a href="https://nominatim.openstreetmap.org/" target="_blank" rel="noreferrer">OpenStreetMap Nominatim</a>.</p>
          <p><strong>Privacy notice:</strong> If you choose “Use my location”, your device may share approximate coordinates with the app to fetch weather. Location search terms and coordinates are sent to the providers above to retrieve results. If you enable “Functional storage”, WearCast stores your preferences and last-used location in your browser.</p>
          <p><strong>Your choices:</strong> You can change these options anytime via the “Privacy” button in the footer.</p>
        </div>
      </details>
    </section>
  </main>

  <footer>
    <span class="muted">WearCast • Weather-powered outfit suggestions</span>
    <div class="footer-actions">
      <button id="installBtn" class="btn" style="padding:8px 10px; min-height: 36px; display:none;">Add to Home Screen</button>
      <button id="privacyBtn" class="btn secondary" style="padding:8px 10px; min-height: 36px;">Privacy</button>
    </div>
  </footer>

  <dialog id="installDialog" class="consent" aria-labelledby="installTitle">
    <form method="dialog" class="consent-inner">
      <h2 id="installTitle">Add WearCast to Home Screen</h2>
      <div class="prose" style="margin-top:10px;">
        <p id="installText">—</p>
        <ol style="margin:10px 0 0; padding-left: 18px;">
          <li>Open the browser menu/share sheet</li>
          <li>Select <strong>Add to Home Screen</strong></li>
          <li>Confirm</li>
        </ol>
      </div>
      <div class="consent-actions">
        <button class="btn" value="ok">OK</button>
      </div>
    </form>
  </dialog>

  <dialog id="consentDialog" class="consent" aria-labelledby="consentTitle">
    <form method="dialog" class="consent-inner">
      <h2 id="consentTitle">Privacy choices</h2>
      <p class="muted" style="margin-top:6px;">WearCast uses third-party services to look up places and fetch weather. Choose what you’re comfortable with.</p>

      <div class="consent-box">
        <label class="consent-item">
          <input type="checkbox" id="consentSelectAll" />
          <span>
            <strong>Select all</strong><br/>
            <span class="muted">Enable all options below.</span>
          </span>
        </label>
        <label class="consent-item">
          <input type="checkbox" id="consentFunctional" />
          <span>
            <strong>Functional storage</strong><br/>
            <span class="muted">Save preferences and last-used location in this browser.</span>
          </span>
        </label>
        <label class="consent-item">
          <input type="checkbox" id="consentLocation" />
          <span>
            <strong>Use device location</strong><br/>
            <span class="muted">Allow “Use my location”. Your browser will still ask for permission when used.</span>
          </span>
        </label>
      </div>

      <div class="consent-actions">
        <button id="consentEssential" class="btn secondary" value="essential">Continue without saving</button>
        <button id="consentAccept" class="btn" value="accept">Accept selected</button>
      </div>

      <p class="muted" style="margin-top:10px; font-size:12px; line-height:1.4;">
        Data recipients: Open‑Meteo and OpenStreetMap Nominatim. WearCast does not run analytics or track users.
      </p>
    </form>
  </dialog>

  <script src="app.js?v=3" type="module"></script>
</body>
</html>
